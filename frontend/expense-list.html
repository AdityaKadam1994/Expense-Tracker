<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    />

    <link rel="stylesheet" href="css/style.css" />
    <title>Expense Tracker</title>
  </head>
  <body>
    <ul class="nav justify-content-center pt-3 pb-3 bg-dark">
      <li class="nav-item">
        <a class="nav-link active" href="/">Expense List</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="expense-add.html">Add Expense</a>
      </li>
    </ul>

    <div class="container">
      <table class="table mt-1">
        <thead class="thead-light">
          <tr>
            <th scope="col">#</th>
            <th scope="col">Date</th>
            <th scope="col">Particulars</th>
            <th scope="col">Quantity</th>
            <th scope="col">Cost</th>
            <th scope="col">Transaction Details</th>
            <th scope="col">Note</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody class="expense-list-tbody"></tbody>
      </table>
    </div>

    <!-- js file declaration -->
    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <script id="entry-template" type="text/x-handlebars-template">
        {{#each this}}
        <tr>
          <th scope="row">{{id}}</th>
          <td>{{Date}}</td>
          <td><a href="#"> {{Item}} </a></td>
          <td>{{Quantity}}</td>
          <td>{{Cost}}</td>
          <td>{{Payment_Mode}}</td>
          <td>{{Note}}</td>
          <td>
            <button type="button" class="btn delete-btn" data-id={{id}}>
              <i class="fa fa-trash" aria-hidden="true"></i>
            </button>
          </td>
        </tr>
        {{else}}
        <tr>
          <td colspan="8" class="text-center"><h4>No data found</h4></td>
        </tr>
      {{/each}}
    </script>
    <script>
      $(document).ready(function() {
        // get expense list
        function getFunctionList() {
          $.ajax({
            headers: { Accept: "application/json" },
            method: "GET",
            url: "http://localhost:3000/expense_list",
            success: function(res) {
              console.log(res);
              let source = $("#entry-template").html();
              let template = Handlebars.compile(source);
              let items = $(".expense-list-tbody");
              $(".expense-list-tbody").append(template(res));
            },
            error: function(er) {
              console.log(er);
            }
          });
        }

        // delete record
        $("body").on("click", ".delete-btn", function() {
          let dataId = $(this).data("id");
          console.log(dataId);
          $.ajax({
            headers: { Accept: "application/json" },
            method: "Delete",
            url: `http://localhost:3000/expense_list/${dataId}`,
            success: function(res) {
              getFunctionList();
            },
            error: function(er) {
              console.log(er);
            }
          });
        });
        getFunctionList();
      });
    </script>
  </body>
</html>
